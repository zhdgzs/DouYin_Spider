## Context

当前 DouYin_Spider 项目是纯命令行工具，需要添加 Web API 和前端界面以降低使用门槛。

**约束条件：**
- 需要兼容现有的 Cookie 认证机制
- 前后端分离架构
- 支持跨域请求
- 视频预览需要处理防盗链问题

**技术选型考量：**
- 后端：FastAPI（异步、自动文档、类型安全）
- 前端：Vue 3 + Vite（轻量、快速、生态成熟）
- UI 组件：Element Plus 或 Naive UI

## Goals / Non-Goals

**Goals:**
- 提供 HTTP API 接口供外部调用
- 提供友好的 Web 界面
- 支持视频多清晰度地址获取
- 支持视频在线预览

**Non-Goals:**
- 不实现用户认证系统（使用 Cookie 配置）
- 不实现数据持久化（无数据库）
- 不实现批量任务队列（Phase 1）

## Decisions

### 1. 后端框架选择：FastAPI

**决定：** 使用 FastAPI 作为后端框架

**理由：**
- 原生异步支持，适合 I/O 密集型爬虫场景
- 自动生成 OpenAPI 文档
- Pydantic 类型验证
- 与现有 Python 代码无缝集成

**备选方案：**
- Flask：更简单但缺乏异步支持
- Django：过于重量级

### 2. 前端框架选择：Vue 3 + Vite

**决定：** 使用 Vue 3 + Vite + TypeScript

**理由：**
- 轻量级，构建速度快
- 组合式 API 更灵活
- TypeScript 支持更好的类型安全
- 生态成熟，组件库丰富

**备选方案：**
- React：学习曲线较陡
- 纯 HTML/JS：维护性差

### 3. 视频预览方案

**决定：** 使用 HTML5 Video 标签 + 代理转发

**理由：**
- 抖音视频有防盗链机制
- 通过后端代理转发视频流可绕过 Referer 检查
- 或使用 video.js 配置自定义请求头

**实现方式：**
```
前端 → 后端代理接口 → 抖音视频服务器
```

### 4. Cookie 管理方案

**决定：** 继续使用 .env 文件配置

**理由：**
- 保持与现有代码兼容
- 简单直接，无需额外的认证系统
- 后续可扩展为 Web 界面配置

## Risks / Trade-offs

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| Cookie 过期 | API 调用失败 | 添加错误提示，引导用户更新 Cookie |
| 视频防盗链 | 预览播放失败 | 后端代理转发或提示用户直接下载 |
| 请求频率限制 | 被抖音风控 | 添加请求间隔，限制并发 |
| 前端构建复杂 | 部署困难 | 提供预构建版本或 Docker 镜像 |

## Migration Plan

1. **Phase 1（本次）：** 添加基础 API 和视频解析页面
2. **Phase 2：** 添加用户作品、搜索功能
3. **Phase 3：** 添加直播监听、批量下载

**回滚方案：**
- API 和前端是独立模块，不影响原有命令行功能
- 可随时删除 `api/` 和 `web/` 目录回滚

## Open Questions

1. 是否需要添加请求频率限制？
2. 是否需要支持 Docker 部署？
3. 前端是否需要支持暗色主题？
